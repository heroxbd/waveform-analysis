\section{Introduction}
\label{sec:introduction}

Waveform analysis of photomultiplier tubes~(PMT) is ubiquitous in fluid-based neutrino and dark matter experiments.  Via hit time and number of photoelectrons~(PE), it provides a more accurate measurement of time and intensity of incident light on a PMT, improves event reconstruction, particle identification and definition of fiducial volume, thus promoting the physics prospect.

In Super-Kamiokande~\cite{noauthor_super-kamiokande_2003}, SNO~\cite{dunger_event_2019} and Daya Bay~\cite{daya_bay_collaboration_measurement_2017}, the time~(TDC) and charge~(QDC) to digital converters recorded the threshold crossing times and integrated charges of PMT waveforms.  Experimentalists deployed fast analog-to-digital converters to record full PMT waveforms in KamLAND~\cite{kamland_collaboration_production_2010}, Borexino~\cite{alimonti_borexino_2009}, XMASS~\cite{abe_xmass_2013} and XENON1T~\cite{xenon_collaboration_xenon1t_2019}.  This technology advancement opened the flexibility of offline waveform analysis after data acquisition.  Nevertheless, limited by data volume and computational efficiency, early adopters emulated TDC/QDC in software with threshold and integration algorithms.  Only recently have people explored methods to extract charge and hit time of each PE~\cite{zhang_comparison_2019}.  However, there is still a great potential for improvements.  We shall see that TDC suffers from the ignorance of the second and subsequent PEs~(section~\ref{sec:time-shift-t_0}), and QDC is hindered by charge fluctuation~(section~\ref{sec:intensity-mu}).

Our mission on waveform analysis is to infer PEs from a waveform, consequently the incident light intensity over time.  The latter is the input to event reconstruction.  We shall go through all the known methods and strive towards the ultimate algorithm that retains all the available information in the data.  In section~\ref{sec:toyMC}, we discuss the principles of PE measurement in PMT-based detectors to justify the toy MC setup.  We then introduce waveform analysis algorithms and characterize their performance In section~\ref{sec:algorithm}.  Finally, in section~\ref{sec:discussion}, we discuss the impact on event reconstruction by comparing the time and intensity resolutions.
